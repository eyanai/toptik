/**
 * CodeNegar Woocommerce AJAX Product Filter 
 *
 * Frontend Script File
 *
 * @package	WooCommerce AJAX Product Filter
 * @author	Farhad Ahmadi
 * @link	http://codenegar.com/woocommerce-ajax-product-filter/
 * version	1.9
 */
 
var codenegar_page_title="";function codenegar_addParameter(a,h,d,b){replaceDuplicates=true;if(a.indexOf("#")>0){var j=a.indexOf("#");urlhash=a.substring(a.indexOf("#"),a.length)}else{urlhash="";j=a.length}sourceUrl=a.substring(0,j);var c=sourceUrl.split("?");var f="";if(c.length>1){var k=c[1].split("&");for(var e=0;(e<k.length);e++){var g=k[e].split("=");if(!(replaceDuplicates&&g[0]==h)){if(f==""){f="?"}else{f+="&"}f+=g[0]+"="+(g[1]?g[1]:"")}}}if(f==""){f="?"}if(b){f="?"+h+"="+d+(f.length>1?"&"+f.substring(1):"")}else{if(f!==""&&f!="?"){f+="&"}f+=h+"="+(d?d:"")}return c[0]+f+urlhash}function codenegar_format_range(d,c,a){var b=d;b=b.replace("%s",c);b=b.replace("%e",a);return b}function codenegar_get_parameter(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+b+"=([^&#]*)";var e=new RegExp(a);var f=History.getState();var d=f.cleanUrl;var c=e.exec(d);if(c==null){return""}else{return c[1]}}function codenegar_wcpf_add_parameter(h,d,a,g){var f=History.getState();var c=f.cleanUrl;var b="";var e=h+"_"+a;if(e=="orderby_orderby"){e="orderby"}b=codenegar_addParameter(c,"cnpf","1",true);b=codenegar_addParameter(b,"cnep","0");b=codenegar_addParameter(b,e,g);if((document.URL==codenegar_wcpf_config.home_url)||(document.URL==codenegar_wcpf_config.home_url+"/")){b=codenegar_addParameter(b,"post_type","product")}if(codenegar_page_title.length==0){codenegar_page_title=jQuery("title").text()}History.pushState({state:1},codenegar_page_title,b)}function codenegar_make_slider(f){var c=parseInt(f.closest(".codenegar_slider_wrapper").next().attr("data-min"));var h=parseInt(f.closest(".codenegar_slider_wrapper").next().attr("data-max"));var i=f.closest(".codenegar_slider_wrapper").next().attr("data-template");var e=f.closest(".codenegar_slider_wrapper").next().attr("data-widget");var g=f.closest(".codenegar_slider_wrapper").next().attr("data-type");var j=f.closest(".codenegar_slider_wrapper").next().attr("data-key");var b=parseInt(f.closest(".codenegar_slider_wrapper").next().attr("data-step"));current_values=codenegar_get_parameter(e+"_"+j);var a=0;var d=0;if(parseInt(codenegar_get_parameter("cnpf"))==1&&current_values.length>0){current_values=current_values.split(",");if(current_values.length==2){a=parseInt(current_values[0]);d=parseInt(current_values[1])}}if(!((parseInt(a)>0))){a=c}if(!((parseInt(d)>0))){d=h}f.slider({range:true,min:c,max:h,step:b,values:[a,d],create:function(k,l){f.closest(".codenegar_slider_wrapper").next().children(".min_value").val(a);f.closest(".codenegar_slider_wrapper").next().children(".max_value").val(d)},slide:function(k,l){f.closest(".codenegar_slider_wrapper").next().children(".min_value").val(l.values[0]);f.closest(".codenegar_slider_wrapper").next().children(".max_value").val(l.values[1]);f.closest(".codenegar_slider_wrapper").next().children(".amount").html(codenegar_format_range(i,l.values[0],l.values[1]))},change:function(k,m){if(k.originalEvent){var l=m.values[0]+","+m.values[1];codenegar_wcpf_add_parameter(e,g,j,l)}}});f.closest(".codenegar_slider_wrapper").next().children(".amount").html(codenegar_format_range(i,a,d))}jQuery(function(){jQuery(".range_meta_slider").each(function(){codenegar_make_slider(jQuery(this))});codenegar_page_title=jQuery("title").text();jQuery("a.codenegar_product_filter_reset_button").live("click",function(h){h.preventDefault();$this=jQuery(this);var g=$this.attr("data-url");g=codenegar_addParameter(g,"cnpf","1");g=codenegar_addParameter(g,"cnep","0");if(codenegar_page_title.length==0){codenegar_page_title=jQuery("title").text()}if(parseInt(codenegar_get_parameter("cat_cat"))>0||parseInt(codenegar_get_parameter("cnpf"))=="0"){var i=codenegar_get_parameter("cat_cat");var f=jQuery('.codenegar_product_filter_wrap ul li.codenegar_applied_filter_cat a[data-old-value="'+i+'"]').attr("data-value");g=codenegar_addParameter(g,"cat_cat",f)}jQuery(".range_meta_slider").each(function(){$this=jQuery(this);var k=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-min"));var j=parseInt($this.closest(".codenegar_slider_wrapper").next().attr("data-max"));var l=$this.closest(".codenegar_slider_wrapper").next().attr("data-template");$this.slider("values",[k,j]);$this.closest(".codenegar_slider_wrapper").next().children(".amount").html(codenegar_format_range(l,k,j))});jQuery(".codenegar_product_filter_wrap select option:first-child").each(function(){jQuery(this).attr("selected","selected")});History.pushState({state:1},codenegar_page_title,g);jQuery(".codenegar_product_filter_wrap ul li").removeClass("codenegar_applied_filter chosen")});jQuery(".codenegar_product_filter_wrap ul li a").live("click",function(j){j.preventDefault();var k=jQuery(this);if(k.attr("data-key")=="cat"&&k.attr("data-widget")=="cat"){k.closest("li").siblings().removeClass("codenegar_applied_filter chosen")}k.closest("li").toggleClass("codenegar_applied_filter chosen");var i=k.attr("data-widget");var l=k.attr("data-type");var n=k.attr("data-key");var m=k.attr("data-value");var g=i+"_"+n;var h=codenegar_get_parameter(g);if(h!=""&&g!="cat_cat"){h=h.split(",")}else{h=[]}var f=jQuery.inArray(m,h);if(f>-1){h.splice(f,1)}else{h.push(m)}new_value=h.join(",");if(g=="cat_cat"&&codenegar_get_parameter("cat_cat")==new_value){new_value=""}codenegar_wcpf_add_parameter(i,l,n,new_value)});jQuery(".codenegar_product_filter_wrap select").change(function(){var j=jQuery("option:selected",this);var i=j.attr("data-widget");var g=j.attr("data-type");var f=j.attr("data-key");var h=j.val();codenegar_wcpf_add_parameter(i,g,f,h)});var c=History.getState();var b=c.cleanUrl;var e=!!(window.history&&history.pushState);var d=!!(b.indexOf("#?")!=-1);var a=!!(b.indexOf("cnpf")!=-1);if(!e&&d&&a){b=b.replace("#?","?");if(codenegar_page_title.length==0){codenegar_page_title=jQuery("title").text()}History.pushState({state:1},codenegar_page_title,b)}});(function(b,c){var a=b.History;if(!a.enabled){return false}a.Adapter.bind(b,"statechange",function(){var f=a.getState();var e=jQuery("span.codenegar-shop-loop-wrapper");if(e.length==0){e=jQuery("ul.products")}var d=e.css("height");e.hide().html('<div id="codenegar_ajax_loader"> <img src="'+codenegar_wcpf_config.loader_img+'" class="codenegar-ajax-loader"/> </div>').css("height",d).fadeIn();if(typeof wcsl_before_ajax=="function"){wcsl_before_ajax()}jQuery.get(f.cleanUrl,function(o){var l=jQuery(o);var u=l.find("span.codenegar-shop-loop-wrapper");var q=l.find("ul.products");if(u.length>0){e.hide().html(u).fadeIn()}else{if(q.length>0){e.hide().html(q).fadeIn()}else{if(codenegar_wcpf_config.display_no_products_message=="yes"){e.hide().html(codenegar_wcpf_config.no_products_message).fadeIn()}}}if(l.find(".codenegar-shop-loop-wrapper").children(".codenegar-shop-pagination-wrapper").length==0){jQuery(".codenegar-shop-pagination-wrapper").hide().html(l.find(".codenegar-shop-pagination-wrapper")).fadeIn()}var s=0;var h=f.cleanUrl;var k=h.substring(h.lastIndexOf("&")+1);if(k.length>0&&k.indexOf("=")>-1){k=k.split("=");if(k.length==2&&k[0]=="cat_cat"){s=k[1]}}if(parseInt(s)>0||s=="0"){var t=jQuery(".codenegar_product_filter_wrap ul li a[data-value="+s+"]").closest(".codenegar_product_filter_wrap");var p=l.find(".codenegar_product_filter_wrap ul li a[data-old-value="+s+"]").closest(".codenegar_product_filter_wrap").children();if(p.length>0){t.hide().html(p).fadeIn()}}if(typeof wcsl_on_update=="function"){var g=wcsl_on_update();var j=g.length;for(var n=0;n<j;n++){var m=g[n];var r=l.find(m);if(r.length>0){jQuery(m).hide().html(r).fadeIn()}else{jQuery(m).hide().html("")}}}}).done(function(){if(typeof wcsl_ajax_done=="function"){wcsl_ajax_done()}}).fail(function(){if(typeof wcsl_ajax_fail=="function"){wcsl_ajax_fail()}e.hide().html(codenegar_wcpf_config.no_products_message).fadeIn()}).always(function(){if(typeof wcsl_after_ajax=="function"){wcsl_after_ajax()}})})})(window);(function(a){a(document).ready(function(){a(function(){jQuery("select.orderby").live("change",function(){if(jQuery(this).hasClass("codenegar_product_filter_orderby")){return}jQuery(this).closest("form").submit()})})})})(jQuery);